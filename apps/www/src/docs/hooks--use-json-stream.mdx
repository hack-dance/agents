# use-json-stream

**Usage**

<span>`@/components/joke-critic.tsx`</span>

```ts
"use client"

import { useState } from "react"

import { useJsonStream } from "@/hooks/use-json-stream"
import { PromptComposer } from "@/components/prompt-composer"
import { jokeCriticScema } from "@/ai/agents/joke-critic-agent/schema"

export default function JokeCritic() {
  const [prompt, setPrompt] = useState("")
  const [response, setResponse] = useState({})

  const { startStream, stopStream, loading } = useJsonStream({
    onReceive: data => {
      setResponse(data)
    },
    onEnd: async ({ content }) => {
      setResponse(content)
    },
    schema: jokeCriticScema
  })

  const sendMessage = async () => {
    if (!prompt.length || loading) return

    try {
      startStream({
        prompt,
        url: "/api/ai/joke-critic",
        ctx: {}
      })
    } catch (e) {
      console.error(e)
    }
  }

  const handleInput = (event: React.ChangeEvent<HTMLInputElement>): void => {
    setPrompt(event.target.value ?? "")
  }

  const handleKeyDown = (event: React.KeyboardEvent<HTMLInputElement>): void => {
    if (event.key === "Enter") {
      event.preventDefault()
      sendMessage()
    }
  }

  return (
    <div className="h-full flex flex-col justify-between py-4 overflow-hidden">
      <div className="p-8">
        <h2>Your joke score</h2>

        <strong>Critique</strong>
        <p>{response?.critique}</p>

        <strong>Funny Factor</strong>
        <p>{response?.funnyFactor}</p>

        <strong>Novelty</strong>
        <p>{response?.novelty}</p>

        <strong>Overall Score</strong>
        <p>{response?.overallScore}</p>
      </div>

      <div className="p-8">
        <PromptComposer
          placeholder="Tell me a joke..."
          loading={loading}
          onChange={handleInput}
          onKeyDown={handleKeyDown}
          onSubmit={sendMessage}
          prompt={prompt}
        />
      </div>
    </div>
  )
}
```
